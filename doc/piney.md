# 小兄许

小兄许（piney）是一个sillytavern角色卡工作站。

![alt text](img/1Capture_2026-02-03_13.31.10.png)

## 安装部署

### Docker部署

**推荐使用 🐳 Docker Compose 部署**

创建文件夹

```
mkdir piney && cd piney
```

创建 docker-compose文件

```
nano docker-compose.yml
```

复制并粘贴下方代码

```
services:
  piney:
    image: ghcr.io/andclear/piney:latest
    container_name: piney
    restart: unless-stopped
    ports:
      - "9696:9696"
    volumes:
      - ./data:/app/data
    environment:
      - RUN_MODE=server
      - PORT=9696
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:9696/api/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

```

按 `Ctrl+O`（字母欧）保存，按`Ctrl+X`退出

然后执行：

```
docker compose up -d
```

### Zeabur部署

`模板`中搜索：`piney`，或者访问：https://zeabur.com/zh-CN/templates/V1MQ5P

点击`部署`即可。

部署过程中仅需填写后期访问的地址。

### 客户端

https://github.com/andclear/piney/releases

可以到这里下载客户端。

⚠️**但是本身基于web开发，所以客户端不一定好用（没有经过很多测试）**，推荐还是使用web版本（docker部署）

## 看板页面

![alt text](img/1Capture_2026-02-03_13.31.10.png)

- 支持明暗模式切换；
- 支持统计当前数据库中角色卡、小剧场、图片和数据总容量；
- 太多卡不知道选择哪张玩？看看今日幸运char，不行就自己抽卡（每次会从数据库中随机3张角色卡，每天可以抽三次。抽中且确认后，会替换今日幸运char）

## 角色库

![alt text](img/1Capture_2026-02-03_13.37.31.png)

- 可以在这里新建角色卡，导入在其他页面，这里只是入口，角色库中的角色卡默认按照最后编辑时间倒序排列；
- 鉴于部分卡面有点不宜展示，所以卡片右上角可以设置关掉小眼睛，封面将会模糊显示；
- 右键点击（移动端为长按）角色卡封面，可以使用右键菜单，多选角色卡，进行删除、移动到其他分类、导出等操作；
- 仅角色卡，此处的删除为软删除，你可以到回收站去恢复或者彻底删除它；
- 点击卡片可以进入角色卡编辑页面；
- 分类管理
![alt text](img/1Capture_2026-02-03_13.37.47.png)
- 标签筛选
![alt text](img/1Capture_2026-02-03_13.38.45.png)

## 角色卡详情页

![alt text](img/1Capture_2026-02-03_13.39.38.png)

- 支持AI智能生成角色卡简介和标签；（需要配置api key）
- 支持更换封面，更换封面时支持webp、jpg、png等格式；
- 支持添加备注；
- 支持**仅供参考**的Token统计；
- 小皮医生功能

### 小皮医生 beta

可以通过调用AI的能力来诊断角色卡、世界书等，并给出修改建议。（需要配置api key）

![alt text](img/1Capture_2026-02-03_13.40.04.png)

单次检测会调用2-3次AI，AI会智能检测世界书中的条目名称，然后选择相关性较高的条目阅读和检测，避免token爆炸。

检测范围包括：
- 设定诊断
- 剧情逻辑
- 人设一致性
- 世界观逻辑
- OOC预警
- 小皮的处方...

"检测报告"会存储在数据库中。

个人感觉挺好玩的。但是仅供参考，娱乐性的功能！

### 设定管理

![alt text](img/1Capture_2026-02-03_14.06.37.png)

页面中将会显示一些"基础"的可配置项（此举是为了简化写卡的复杂性，如果需要更多配置项，还是要到酒馆中编辑），不是特别重要的都在小兄许中被隐去。

开场白支持显示多个。所有文本区域部分都支持**全屏编辑**功能，编辑和阅读体验更好。

所有文本区域中都支持**AI优化**和**AI翻译**功能，鼠标放上去就会出现（移动端始终显示）。（AI优化和AI翻译功能需要配置api key）

**创作者**部分：不允许修改"导入"的角色卡的创作者信息。

如果这张卡是你自己创作的，也可以在"版本历史"tab的最底部进行认领。

#### **开场白预览**

![alt text](img/1Capture_2026-02-03_14.07.16.png)

开场白中的样式可以直接预览显示（画板图标）

多开场白也支持

#### AI角色生成

![alt text](img/1Capture_2026-02-03_14.07.31.png)

为了尊重原作者的内容，仅支持**自己创作**的角色卡进行AI生成（在小兄许中新建的角色卡或认领的角色卡）。（AI生成开场白、世界书条目功能同样如此）

用户输入简单的提示词，即可生成详细的任务设定，支持二次编辑和修改。

### 角色卡内嵌世界书管理

![alt text](img/1Capture_2026-02-03_14.09.27.png)

- 简化了大量设置项，只保留了最常用的功能；
- 世界书条目同样支持AI优化和AI翻译；
- 支持开关条目、拖拽条目、重命名世界书等；

#### 世界书互导

![alt text](img/1Capture_2026-02-03_14.09.51.png)

支持从全局世界书中导入条目到当前角色内嵌世界书：

![alt text](img/1Capture_2026-02-03_14.10.25.png)

同样，也支持将当前角色的内嵌世界书条目导入到全局世界书：

![alt text](img/1Capture_2026-02-03_14.18.33.png)

请尊重原作者的劳动成果，不要盗用他人作品！

### 角色卡内嵌正则管理

![alt text](img/1Capture_2026-02-03_14.20.03.png)

- 简化了大量设置项，只保留了最常用的功能；
- "**高级模式**"支持和sillytavern中同样的设置项和功能；
- 支持开关条目、拖拽条目、重命名正则等；


因为大部分正则条目的"替换"内容是样式代码，所以这里的"全屏编辑"是代码编辑器样式：

![alt text](img/1Capture_2026-02-03_14.20.26.png)

- 可以一边编辑一边预览渲染效果；
- 高级预览下可以直接应用正则后渲染；
- AI给的代码是堆在一起的一坨，可读性很差？直接格式化显示更清晰！

### 角色卡快速回复

应`@薯片`的要求，现在你可以导入快速回复文件囤着了。

![alt text](img/1Capture_2026-02-03_14.20.45.png)

### 角色卡版本历史

![alt text](img/1Capture_2026-02-03_14.21.20.png)

你可以创建角色卡版本历史，类似于在游戏中创建存档（SL大法好）。

切换到对应的版本历史，你的所有修改都将回滚。

你可以切换到任意的版本进行使用。

（作者升级了角色卡，下载后会作为一张新卡，不会出现在这里作为新版本）

#### 认领角色卡

我把这个功能藏在了版本历史中。

![alt text](img/1Capture_2026-02-03_14.21.53.png)

自己创作的角色卡可以认领，认领后会解锁`AI生成角色描述`、`AI生成世界书`、`AI生成开场白`、`更改署名`功能。

但是，非自己创作的角色卡就不要申领了！非常不礼貌！

![alt text](img/1Capture_2026-02-03_14.22.00.png)

### 角色卡聊天记录

![alt text](img/1Capture_2026-02-03_14.22.34.png)

可以导入角色卡的聊天记录，支持txt格式和jsonl格式。

默认导入的jsonl格式的聊天记录，会被转为txt格式！！

**仅开启随风模式**的情况下，才会导入原版的jsonl格式的聊天记录。

![alt text](img/1Capture_2026-02-03_14.25.43.png)

---

jsonl格式的聊天记录，可以配置**正则**，小兄许将会应用这些正则来处理jsonl格式的聊天记录。

![alt text](img/1Capture_2026-02-03_14.22.57.png)

（这里的正则，应当上传预设的正则文件，可以导入和导出正则包（多个正则文件合并为同一个文件））

预览一下渲染的结果吧：

![alt text](img/1Capture_2026-02-03_14.25.24.png)

渲染的效果还是可以的。

支持保存进度，下次进入会从最后一次阅读的位置继续阅读。

txt格式的聊天记录，每页支持20组对话，jsonl格式的聊天记录，每页支持1组对话。电脑`←``→`键可以翻页，手机端左右滑动可以翻页。

## 小剧场 

![alt text](img/1Capture_2026-02-03_14.26.07.png)

支持保存你喜欢的小剧场。

支持彩色标签、自动生成分类、一键复制小剧场内容。

建议配合"[回声小剧场](https://discord.com/channels/1291925535324110879/1449044528408428676/0)"使用。

批量导入和导出时，都是兼容回声小剧场的格式。

![alt text](img/1Capture_2026-02-03_14.26.18.png)

## 全局世界书

![alt text](img/1Capture_2026-02-03_14.26.47.png)

可以导入全局世界书。

可以编辑其中的条目。（功能和角色卡内嵌世界书一致，不多做介绍）

## 图库

![alt text](img/1Capture_2026-02-03_14.28.36.png)

在`@随风` 的肘击下，增加了一个图库功能（虽然我也不是很理解）。

- 支持分类、收藏功能，收藏的图片始终显示在最前方；
- 支持以颜色进行筛选；
- 支持搜索，搜索范围包括图片名称、标签、分类、正向提示词；
- 支持选择图片是否获得许可（版权标记）；
- 支持选择图片是否为AI生成，如果检测到图片中包含提示词，将自动打上AI生成的标记；

![alt text](img/1Capture_2026-02-03_14.29.53.png)

支持 `NovelAI`、`ComfyUI`生成的图片，自动识别其中的正向/负向提示词（必须原图）。

## 导入

![alt text](img/1Capture_2026-02-03_14.30.14.png)

导入页面只支持导入角色卡、全局世界书。

角色卡支持json格式和png格式，png格式的文件中没有角色信息的将会失败。

## 前端美化——皮皮美化工作台

该功能需要配置API。

功能请看图：

（图中我使用的是`gemini-3-flash`模型）

![alt text](img/1Capture_2026-02-03_14.34.06.png)

- 支持输入原始文本，AI会根据你输入的原始文本，以及你输入的内容进行美化样式的输出。
- AI会同时输出正则脚本、样式代码、世界书条目；
- 支持生成的样式实时渲染；
- 在实时渲染的样式中，支持"点击编辑"功能，在该功能中，可以选择元素，添加到聊天，让AI只更改你选择的元素。
- 支持保存样式，保存后可以在"样式库"中查看。

![alt text](img/1Capture_2026-02-03_14.37.33.png)

### 样式一键插入到角色卡

可以一键将生成的正则脚本、样式代码、世界书条目插入到当前角色卡中。

![alt text](img/1Capture_2026-02-03_14.36.52.png)

![alt text](img/1Capture_2026-02-03_14.37.20.png)

## 回收站

![alt text](img/1Capture_2026-02-03_14.38.04.png)

仅**角色卡**在删除时会进入回收站。

回收站默认无期限永久保留。

## 数据备份

![alt text](img/1Capture_2026-02-03_14.38.17.png)

支持一键将整个小兄许中的数据全部打包导出。

导出的文件为`.piney`格式。

![alt text](img/1Capture_2026-02-03_14.38.28.png)

支持一键导入`.piney`格式的数据，一键恢复所有数据。

⚠️ 全量覆盖！原有数据将会全部丢失。

## 系统设置 

### API设置

![alt text](img/1Capture_2026-02-03_14.39.05.png)

**仅支持OpenAI API格式的API**

支持配置多个渠道，支持一键检测。

### 全局提示词

![alt text](img/1Capture_2026-02-03_14.39.13.png)

可以设置全局提示词，所有AI调用时（除了前端美化样式生成），都会注入到现有提示词的最前面。

### 关于 

当前版本 `0.2.6` ，有什么问题/错误，请回复。看到了我会修。

![alt text](img/1Capture_2026-02-03_14.39.34.png)

致谢 @我不理解 @随风飘逸 @薯片 @KAKAA @青空莉想做舞台少女的狗 @lucialili @温柔半两