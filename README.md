# 小兄许 (Piney)

小兄许（Piney）是一个 SillyTavern 角色卡工作站。

## 安装部署

### Docker部署

**推荐使用 🐳 Docker Compose 部署**

1. 创建文件夹

```bash
mkdir piney && cd piney
```

2. 创建 `docker-compose.yml` 文件

```bash
nano docker-compose.yml
```

3. 复制并粘贴下方代码

```yaml
services:
  piney:
    image: ghcr.io/andclear/piney:latest
    container_name: piney
    restart: unless-stopped
    ports:
      - "9696:9696"
    volumes:
      - ./data:/app/data
    environment:
      - RUN_MODE=server
      - PORT=9696
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:9696/api/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
```

4. 按 `Ctrl+O` 保存，按 `Ctrl+X` 退出

5. 启动服务

```bash
docker compose up -d
```

### Zeabur部署

在 `模板` 中搜索：`Piney`，或者访问：[Zeabur Template](https://zeabur.com/zh-CN/templates/V1MQ5P)

点击 `部署` 即可。部署过程中仅需填写后期访问的地址。

### 客户端

[下载地址](https://github.com/andclear/piney/releases)

⚠️ **注意**：本项目本身基于 Web 开发，客户端可能存在兼容性问题（未经大量测试），**推荐使用 Web 版本（Docker 部署）**。

## 功能介绍

### 📊 看板页面

- **明暗模式**：支持明暗模式切换。
- **数据统计**：统计当前数据库中角色卡、小剧场、图片和数据总容量。
- **今日运势**：每天可以抽三次卡（每次随机 3 张），确认后会替换今日幸运 Char。

### 📚 角色库

- **管理功能**：作为入口，默认按最后编辑时间倒序排列。
- **隐私保护**：支持开启/关闭封面模糊显示（"小眼睛"功能）。
- **右键菜单**：右键点击（移动端长按）封面，可进行多选删除（软删除）、移动分类、导出等操作。
- **分类与标签**：支持分类管理和标签筛选功能。

### 📝 角色卡详情页

- **AI 辅助**：支持 AI 智能生成角色卡简介和标签（需配置 API Key）。
- **封面管理**：支持更换封面（WebP, JPG, PNG）。
- **Token 统计**：支持**仅供参考**的 Token 统计。
- **备注系统**：支持添加备注。

#### 🩺 小皮医生 (Beta)

通过 AI 能力诊断角色卡、世界书等，并给出修改建议。
- **智能检测**：AI 会智能筛选相关世界书条目进行阅读，避免 Token 爆炸。
- **检测范围**：设定诊断、剧情逻辑、人设一致性、世界观逻辑、OOC 预警等。
- **检测报告**：自动存储在数据库中。
*(注：仅供参考，娱乐性功能)*

#### ⚙️ 设定管理

- **简化配置**：显示基础配置项，降低写卡复杂度。支持 AI 优化和 AI 翻译所有文本区域。
- **全屏编辑**：所有文本区域支持全屏编辑。
- **创作者信息**：不允许修改“导入”卡的创作者信息；自己创作的卡可在“版本历史”中认领。
- **开场白预览**：支持直接预览开场白样式（包括多开场白）。
- **AI 角色生成**：仅支持**自己创作**的角色卡进行 AI 生成（任务设定等）。

### 🌍 角色卡内嵌世界书

- **简化管理**：保留最常用功能，支持 AI 优化/翻译条目。
- **互导功能**：
    - 支持从全局世界书导入条目到当前角色。
    - 支持将当前角色的世界书条目导出到全局世界书。

### 🧩 角色卡内嵌正则

- **功能精简**：“高级模式”支持与 SillyTavern 一致的设置项。
- **代码编辑器**：正则条目的“全屏编辑”为代码编辑器样式，支持实时预览渲染效果、代码格式化。

### 💬 角色卡快速回复

支持导入/导出快速回复文件。

### 🕰 版本历史 & 认领

- **存档机制**：类似游戏的 SL 大法，创建版本历史后，修改可回滚。
- **作品认领**：在版本历史页底部，可认领**自己创作**的角色卡，解锁 AI 生成描述/世界书/开场白及更改署名功能。*(请勿冒领他人作品)*

### � 聊天记录

- **格式支持**：支持导入 TXT 和 JSONL 格式。默认 JSONL 会转为 TXT。
- **随风模式**：仅开启此模式下，才会导入并保留原版 JSONL 格式。
- **正则渲染**：支持配置预设正则文件，对聊天记录进行渲染预览。
- **阅读进度**：自动保存最后阅读位置。

### 🎭 小剧场

- **收藏管理**：保存你喜欢的小剧场，支持彩色标签、自动分类。
- **格式兼容**：批量导入/导出兼容“回声小剧场”格式。

### 🌐 全局世界书

支持导入和编辑全局世界书，功能与角色卡内嵌世界书一致。

### 🖼️ 图库

- **图片管理**：支持分类、收藏（置顶显示）、颜色筛选。
- **搜索**：支持搜索名称、标签、分类、正向提示词。
- **元数据识别**：自动识别 NovelAI/ComfyUI 生成的图片（原图），标记 AI 生成并保留提示词信息。

### 📥 导入

仅支持导入角色卡（JSON/PNG）和全局世界书。PNG 需包含角色信息。

### ✨ 皮皮美化工作台

*(需配置 API)*
- **AI 美化**：根据原始文本和输入内容，AI 输出正则脚本、样式代码、世界书条目。
- **实时渲染**：支持生成的样式实时预览与“点击编辑”（AI 针对性修改）。
- **一键插入**：生成的资源可一键插入到当前角色卡。

### 🗑️ 回收站

仅**角色卡**删除后进入回收站。
**注意**：回收站默认**无期限永久保留**，需手动清理。

### 📦 数据备份

支持一键全量导出（`.piney` 格式）与恢复。
⚠️ **注意**：恢复操作为**全量覆盖**，原有数据将全部丢失。

## 系统设置

- **API 设置**：支持 OpenAI 格式 API，支持多渠道配置与一键检测。
- **全局提示词**：设置后注入到所有 AI 调用（除前端美化外）的最前方。

## 关于

当前版本：`0.2.6`
如有问题请反馈。

致谢：@我不理解 @随风飘逸 @薯片 @KAKAA @青空莉想做舞台少女的狗 @lucialili @温柔半两